<template name="projectInfo">
  <div class="ui big top attached label">
    Project Info
  </div>
  {{#if Template.subscriptionsReady}}
    {{> progress}}
    {{>projectDetails details}}
  {{else}}
    <div class="ui active centered inline loader"></div>
  {{/if}}
</template>

<template name="projectDetails">
  <div class="ui grid">
      <div class="fluid four wide column">
        {{> verticalProjectMenu}}
      </div>
    <div class="fluid twelve wide column">
      <table class="ui basic single line striped table">
        <thead>
          <tr>
            <th>Open Task</th>
            <th>Assigned To</th>
            <th>Due Date</th>
          </tr>
        </thead>
        <tbody>
          {{#each tasks}}
            {{> taskDetailCompact}}
          {{/each}}
        </tbody>
        <tfoot class="full-width">
          <tr>
            <th colspan="3">
              <!-- TODO: fix button -->
              <div class="ui right floated small labeled button task-add-button">
                Add Task
              </div>
            </th>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
  <div class="ui divider"></div>
  {{> projectComments}}
</template>

<template name="projectComments">
  <p>
    Leave a comment.
  </p>
  <form class="ui form">
    <div class="ui mini input">
      <input class="root-comment-text" type="text">
      <button class="ui mini button root-comment-button">Comment</button>
    </div>
  </form>

  <div class="ui horizontal divider header">Comments</div>
  <div class="ui comments no-padding-bottom">
    {{#each comments}}
      {{> projectCommentsRow}}
      <div class="ui divider"></div>
      {{/each}}
  </div>
</template>

<template name="projectCommentsRow">
  <div class="comment">
    <div class="content">
      <a class="author">{{profile.name}}</a> {{#if isUserComment}}<i class="admin-flair small star icon"></i>{{/if}}
      <div class="metadata">
        <span class="date">{{aLongLongTimeAgo}}</span>
      </div>
      <div class="text">
        {{comment}}
      </div>
      <a class="text-action comment-reply">Reply</a>
      {{#if showRemove}}<a class="text-action comment-remove">Remove</a>{{/if}}
      {{#if isAdmin true false}}<a class="text-action comment-delete">Delete</a>{{/if}}
    </div> <!-- content -->

    <form class="ui form comment-container" style="display: none;">
      <div class="ui mini input">
        <input class="comment-text" type="text">
        <button class="ui mini button comment-button">Comment</button>
      </div>
    </form>

      {{#if hasReplies}}
        <div class="ui comments no-padding-bottom">
          {{#each replies}}
            {{> projectCommentsRow}}
          {{/each}}
        </div>
      {{/if}}
  </div> <!-- comment -->
</template>

<template name="taskDetailCompact">
  <tr>
    <td>
      <a class="task" href="/tasks/{{_id}}">{{title}}</a>
    </td>
    <td>
      <a class="user" href="/users/{{createdId}}">{{assignedTo}}</a>
    </td>
    <td class="collapsing">{{dueDateString}}</td>
  </tr>
</template>

<template name="progress">
  <div class="ui fluid steps">
    <div class="completed step">
      <div class="content">
        <div class="title">Project Request</div>
        <div class="description">Finalize user request</div>
      </div>
    </div>
    <div class="completed step">
      <div class="content">
        <div class="title">Requirements</div>
        <div class="description">Create requirements document</div>
      </div>
    </div>
    <div class="active step">
      <div class="content">
        <div class="title">Development</div>
        <div class="description">User requirements to code</div>
      </div>
    </div>
    <div class="step">
      <div class="content">
        <div class="title">Testing</div>
        <div class="description">Test features for requirements</div>
      </div>
    </div>
    <div class="step">
      <div class="content">
        <div class="title">UAT</div>
        <div class="description">Test with and get user approval</div>
      </div>
    </div>
  </div>
</template>

<template name="verticalProjectMenu">
  <div class="ui vertical menu">
    <div class="item">
      <div class="header">Information</div>
      <div class="menu">
        <a class="item">View Tasks</a>
        <a class="item">View Assignments</a>
        <a class="item">View Resources</a>
        <a class="item">View Stats</a>
      </div>
    </div>
    {{#if isInRole "admin,project-mgr"}}
    <div class="item">
      <div class="header">Project Management</div>
      <div class="menu">
        <a class="item">Edit Project</a>
        <a class="item">Edit Assignments</a>
        <a class="item">Post Announcement</a>
      </div>
    </div>
    {{/if}}
    {{#if isInRole "admin"}}
      <div class="item">
        <div class="header">Admin</div>
        <div class="menu">
          <a class="item">Ghost Project</a>
        </div>
      </div>
    {{/if}}
  </div>
</template>
